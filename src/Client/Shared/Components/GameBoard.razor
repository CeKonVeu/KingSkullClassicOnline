@using Microsoft.AspNetCore.SignalR.Client
@using KingSkullClassicOnline.Client.Shared.Popups
@inherits ComponentBase
@inject IDialogService DialogService

@if (!IsVisible)
{
    return;
}

<PageTitle>Jeu</PageTitle>

<HandGame Cards="Cards"/>

@code {

    [Parameter]
    public HubConnection Connection { get; set; } = null!;

    [Parameter]
    public ICollection<string> Cards { get; set; } = new List<string>();

    [Parameter]
    public bool IsVisible { get; set; }

    private async Task<int> AskVote()
    {
        var options = new DialogOptions { CloseOnEscapeKey = false, CloseButton = false, DisableBackdropClick = true };
        var parameters = new DialogParameters { ["MaxValue"] = 5 };
        var dialog = DialogService.Show<Vote>("Votez !", parameters, options);
        var result = await dialog.Result;
        return (int)result.Data;
    }

    protected override async Task OnInitializedAsync()
    {
        Connection.On("VoteAsked", async () =>
        {
            var t = await AskVote();
            Console.WriteLine(t.ToString());
        });
    }

}