@page "/startGame"
@using Microsoft.AspNetCore.SignalR.Client
@inject IJSRuntime JS
@inject NavigationManager NavigationManager
@inject IDialogService DialogService

<h3>@lobbyName</h3>
<MudButton @onclick="Start" Variant="Variant.Filled" Color="Color.Primary">
    @wow
</MudButton>

@code {
    private readonly List<string> messages = new();

    private readonly string lobbyName = Data.LobbyName;
    private readonly string wow = "Start";
    private HubConnection? hubConnection;

    async Task Start()
    {
        await hubConnection.SendAsync("StartGame", Data.LobbyName);
        StateHasChanged();
    //await Data.HubConnection.SendAsync("StartGame", Data.LobbyName);
    }

    protected override async Task OnInitializedAsync()
    {
        hubConnection = new HubConnectionBuilder()
            .WithUrl(NavigationManager.ToAbsoluteUri("/chathub"))
            .Build();

        await hubConnection.StartAsync();

        if (hubConnection is not null)
        {
            await hubConnection.SendAsync("JoinGroup", Data.LobbyName, Data.Player);
        }

        hubConnection.On("StartGame", () =>
        {
            hubConnection.SendAsync("LeaveGroup", lobbyName, Data.Player);

            NavigationManager.NavigateTo("/Game");
        });
        StateHasChanged();
    }

}